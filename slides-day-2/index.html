<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Introduction to Backbone.js and Web-apps Bootcamp</title>
  
    <link rel="stylesheet" href="reveal/css/reveal.min.css">
    <link rel="stylesheet" href="reveal/css/theme/beige.css" id="theme">

    <!-- For syntax highlighting reveal/-->
    <link rel="stylesheet" href="reveal/lib/css/zenburn.css">
</head>

<body>

<div class="reveal">
<div class="slides">

<section data-markdown ><script type="text/template">
# INTRODUCTION TO BACKBONE.JS AND WEB APPS BOOTCAMP


[@timruffles](http://twitter.com/timruffles)

[truffles.me.uk](http://truffles.me.uk)


</script></section>

<section data-markdown ><script type="text/template">
# Day 2

```
git pull origin bootcamp
```

- Might be worth creating a branch for your work


</script></section>

<section data-markdown ><script type="text/template">

# Final day's sessions

<table>
  <tr>
    <td>AM:</td><td>Testing</td>
  </tr>
  <tr>
    <td>PM:</td><td>Plugins, extend and test application</td>
  </tr>
</table>


</script></section>

<section data-markdown ><script type="text/template">
# Tests are great

- confidence
- user confidence - no regressions
- change fearlessly
- collaboration
- drudge work
- no code rot

</script></section>

<section data-markdown ><script type="text/template">

# Confidence

- How can you know something works?
- Code, alt-tab browser, code etc
- change: you're unsure
- test suite covers everything - no whack-a-mole


</script></section>

<section data-markdown ><script type="text/template">

# User confidence

- Regressions sap confidence
- Don't let your users be your quality-assurance

</script></section>

<section data-markdown ><script type="text/template">

# Change fearlessly

- it's easy to break code while refactoring
- if you test behaviour, not implementation, implementation can change

</script></section>

<section data-markdown ><script type="text/template">

# Collaboration

- It's even easier to break other peoples' code
- Tests can ensure merges were good, and both sets of functions still work
- Documents how a module is to be used

</script></section>

<section data-markdown ><script type="text/template">

# Remove drudge work

- Manually testing is silly, we're automaters
- Testing on IE6, IE7 ...
- Running test suite on every little change - humans are bad at this


</script></section>

<section data-markdown ><script type="text/template">

# Code rot

- Tests let you quickly get up to speed
- You have some running code by definition
- Documents intent
- Ensures you can change code you don't fully understand

</script></section>

<section data-markdown ><script type="text/template">

# How to test

- We test the code has the correct behaviour

</script></section>

<section data-markdown ><script type="text/template">

# Behaviour

- what the code does for the outside world
- the rest of your code
- or the public API you've documented and exposed
- effect, not the cause

</script></section>

<section data-markdown ><script type="text/template">

# Implementation

- How the code does it
- Internal API, private
- Behaviour: "adds class to DOM element"
- Implementation: "uses element.classList.add()"

</script></section>

<section data-markdown ><script type="text/template">

# Behaviour example

- We're just talking about the work our function does

```
highlightElement(el)
assert.true( el.classList.has("highlit") )
```


</script></section>

<section data-markdown ><script type="text/template">

# Implementation example

- Here we're ensuring that the work was done in a certain way

```
var classListAddWasCalled = false
el.classList.has = function() {
  classListAddWasCalled = true
}
highlightElement(el)
assert.true( classListAddWasCalled )
```

</script></section>

<section data-markdown ><script type="text/template">

# Why behaviour?

- Implementation is fragile - changeable
- We only care that the module's work is done, not how
- Lets us refactor without breaking tests
- Avoids over-testing - we can cover implementation by testing behaviour

</script></section>

<section data-markdown ><script type="text/template">

# What do we test in Backbone?

</script></section>

<section data-markdown ><script type="text/template">

# Everything!

- Models & Collections
- Views
- Router
- Sync extensions

</script></section>

<section data-markdown ><script type="text/template">

# How do we test?

</script></section>

<section data-markdown ><script type="text/template">

# We write code to test code

- Write test cases in suites
- Each unit test tests an 'atom' of functionality
- Write assertions that cause failing tests
- A test runner runs our tests, reports on failures

</script></section>

<section data-markdown ><script type="text/template">

# Unit tests

- Smallest tests
- In isolation - one function, class, or module
- Ensure your app works bottom-up

</script></section>

<section data-markdown ><script type="text/template">

# Functional tests

- AKA 'integration tests'
- Ensure modules work together
- Can be full-stack
- Test your view's interaction with models

</script></section>

<section data-markdown ><script type="text/template">

# Our test runner

- Karma - from Angular.js team
- Allows testing on real browsers
- Simultaenous tests on different browsers
- Headless testing via phantomjs
- Auto test on changes

</script></section>

<section data-markdown ><script type="text/template">

# Our assertion library

- chai
- has multiple UIs
- can be used for node too
- we'll be using simplest - chai.assert
- self-documenting 

</script></section>


<section data-markdown ><script type="text/template">

# Our test framework

- mocha
- has multiple UIs
- can be used for node too
- we'll be using simplest - mocha.tdd
- use it with an assertion library

</script></section>

<section data-markdown ><script type="text/template">

# Getting setup

- Install node via installer from [nodejs.org](http://nodejs.org)
- Install karma & deps as global module

```
npm install --global karma
npm install --global karma-mocha
npm install --global karma-chrome-launcher
```


</script></section>

<section data-markdown ><script type="text/template">

# Running tests

- Navigate to `test-skeleton`
- Run the following to start with auto-watcher

```
karma start
```

- Should see some passing and failing tests

```
Chrome 28.0.1500 (Mac OS X 10.7.5) Exercise validates reps FAILED
	expected null to be truthy
	AssertionError: expected null to be truthy
Chrome 28.0.1500 (Mac OS X 10.7.5) Exercise validates sets FAILED
	expected null to be truthy
	AssertionError: expected null to be truthy
Chrome 28.0.1500 (Mac OS X 10.7.5): Executed 3 of 3 (2 FAILED) (0.179 secs / NaN secs)
```

</script></section>

<section data-markdown ><script type="text/template">

# The testing loop

- Consider the behaviour you want
- Write a test that documents the behaviour
- Make sure it fails
- Then make it pass
- If retro-test, ensure break test to avoid false-positives

</script></section>

<section data-markdown ><script type="text/template">

# Our first unit test

- Testing our validation
- We set reps, and ensure it is validated

```
suite("Exercise",function() {
  test("validates reps", function() {
    var exercise = new Exercise()
    exercise.set("sets",0)
    exercise.isValid()

    assert.ok( exercise.validationError != null )
  })
})
```

</script></section>

<section data-markdown ><script type="text/template">

# Time to make it pass

- Source code is in `test-skeleton/src`
- Tests are in `test-skeleton/test`

</script></section>

<section data-markdown ><script type="text/template">

# Removing setup

- use `beforeEach` to create setup before each test
- use `before` to setup before all tests

```
suite("Exercise",function() {
  
  var exercise;
  beforeEach(function() {
    exercise = new Exercise()
  })


  test("validates reps", function() {
    // can see the exercise variable
  })
})
```

</script></section>

<section data-markdown ><script type="text/template">

# Giving context

- group related tests
- have granular setup methods for those tests

```
suite("calculations", function() {
  beforeEach(function() {
    // builds on original context
    exercise.set({reps: 5, sets: 5})
  })
  test("volume",function() {
    // test within the context
  })
})
```

</script></section>

<section data-markdown ><script type="text/template">

# Mocking and stubbing

- Mocks enforce a method being called
- Use mocks when the behaviour is calling a method
- Stubs let you fake implementation - e.g a slow database call
- Use stubs when the method is not the behaviour being tested

</script></section>

<section data-markdown ><script type="text/template">

# Mock & stub library: sinon

- node & browser
- has stubs and mocks
- spys are low level tool to create
- also has a fake-server for API testing

</script></section>

<section data-markdown ><script type="text/template">

# Plugins

- Backbone is small
- Lots of common patterns
- Plugins let you avoid re-writing, and use tested code

</script></section>

<section data-markdown ><script type="text/template">

# Require.js

- modules for Javascript
- designed for browser
- asynchronous - can load in on demand


</script></section>

<section data-markdown ><script type="text/template">
# define

- defines a module
- has dependencies on other modules
- return the thing you're defining

```
define(["some/module","another/module",function(SomeModule,AnotherModule) {
  var MyModule = {};
  return MyModule;
})
```
</script></section>

<section data-markdown ><script type="text/template">

# require

- when you're using modules not defining - e.g init scripts

```
require(["views/app","router"],function(AppView,Router) {
  // kick off application
})
```

</script></section>


<section data-markdown ><script type="text/template">

# Has optimiser

- build up a whole script
- looks at all the dependencies and builds into one
- can split out into layers to lazy-load
- e.g highcharts loaded only when we have graphs

</script></section>
<section data-markdown ><script type="text/template">

# Backbone.Marionette

- Plugins for common patterns
- e.g CollectionView
- You'll probably build something like it if you don't use

</script></section>
<section data-markdown ><script type="text/template">

# Regions

- Way of having one DOM element you can switch views in and out of
- e.g tabs, or top-level views for routing

</script></section>
<section data-markdown ><script type="text/template">

# CollectionView

- Define an `itemView` property
- Handles adding/removing etc

```
var ItemView = Backbone.Marionette.ItemView.extend({
  template: getTemplate("some-item")
});

var CollectionView = Backbone.Marionette.CollectionView.extend({
  itemView: ItemView
});
```


</script></section>
<section data-markdown ><script type="text/template">

# Region

- Manages an el
- Can switch views in/out

```
var stage = new Backbone.Marionette.Region({
  el: this.$("#mainStage")
});
stage.show(exercises)
```

</script></section>
<section data-markdown ><script type="text/template">

# EventAggregator

- pub/sub
- really simple to build your own

```
var pubSub = _.extend({},Backbone.Events)
```

- use to decouple components - they just share the pubSub component


</script></section>
<section data-markdown ><script type="text/template">

# Extending Backbone

- Sync is simple
- Extending Model or View requires you know about `call`, `apply` and `prototype`

</script></section>
<section data-markdown ><script type="text/template">

# Adding a localStorage sync

- Override sync for a single model
- Implement each of the verbs

</script></section>

<section data-markdown ><script type="text/template">

# Showtime!

- Make our application use all the things
- Test drive some new functionality
- Use regions, CollectionView etc to clean up the app
- Use localStorage sync to store user preferences

</script></section>


</div>
</div>

<script src="reveal/lib/js/head.min.js"></script>
<script src="reveal/js/reveal.min.js"></script>
<script>
  Reveal.initialize({

    // Display controls in the bottom right corner
    controls: false,

    // Display a presentation progress bar
    progress: true,

    // Push each slide change to the browser history
    history: true,

    // Enable keyboard shortcuts for navigation
    keyboard: true,

    // Enable the slide overview mode
    overview: true,

    // Vertical centering of slides
    center: false,

    // Loop the presentation
    loop: false,

    // Change the presentation direction to be RTL
    rtl: false,

    // Number of milliseconds between automatically proceeding to the
    // next slide, disabled when set to 0, this value can be overwritten
    // by using a data-autoslide attribute on your slides
    autoSlide: 0,

    // Enable slide navigation via mouse wheel
    mouseWheel: false,

    // Apply a 3D roll to links on hover
    rollingLinks: false,

    // Transition style
    transition: 'linear', // default/cube/page/concave/zoom/linear/fade/none

    dependencies: [
        // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
        { src: 'reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },

        // Interreveal/pret Markdown in <section> elements
        { src: 'reveal/plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'reveal/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },

        // Syntareveal/x highlight for <code> elements
        { src: 'reveal/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

        // Zoom reveal/in and out with Alt+click
        { src: 'reveal/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },

        // Speakreveal/er notes
        // { src: 'reveal/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },

        // Remotreveal/e control your reveal.js presentation using a touch device
        // { src: 'reveal/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
    ]

  });
</script>
</body>

